<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.mawujun.inventory.MonthInventoryRepository">
	<!--计算在建仓库-->
	<parameterMap type="map" id="proc_monthinventory1_map">  
	   <parameter property="store_id_in" jdbcType="VARCHAR" mode="IN"/>   
	   <parameter property="month_in" jdbcType="VARCHAR" mode="IN"/>   
	</parameterMap>  
	<update id="proc_monthinventory1" parameterMap="proc_monthinventory1_map" statementType="CALLABLE">  
       {call proc_monthinventory1(?, ?,'N')}  
   </update> 
   <!--计算备品备件仓库 -->
   <parameterMap type="map" id="proc_monthinventory_map">  
	   <parameter property="store_id_in" jdbcType="VARCHAR" mode="IN"/>   
	   <parameter property="month_in" jdbcType="VARCHAR" mode="IN"/>   
	</parameterMap>  
	<update id="proc_monthinventory" parameterMap="proc_monthinventory_map" statementType="CALLABLE">  
       {call proc_monthinventory(?, ?,'N')}  
   </update> 
    
   <update id="updateField" parameterType="map">
   	update ems_monthinventory set ${field}=#{value}
   	where monthkey=#{monthkey} and 
   	subtype_id=#{subtype_id} and 
   	prod_id=#{prod_id} and
   	brand_id=#{brand_id} and
   	style=#{style} and
   	store_id=#{store_id} 
   </update>
   
   <select id="queryMonthReport" resultType="com.mawujun.inventory.MonthInventoryVO">
   select distinct a.*,b.name as subtype_name,c.name as prod_name,c.unit,d.name as brand_name  
    from ems_monthinventory a
    inner join ems_equipmentsubtype b on a.subtype_id=b.id
    inner join ems_equipmentprod c on a.prod_id=c.id
    inner join ems_brand d on a.brand_id=d.id
    where a.store_id=#{store_id} and a.monthkey=#{month_in}
    order by a.subtype_id ,a.prod_id,a.brand_id,a.style
   </select>
   
   <!-- 查询一个只包含维度信息的月结表 -->
   <select id="queryNullMonthReport" resultType="com.mawujun.inventory.MonthInventoryVO">
        select distinct a.subtype_id,a.prod_id,a.brand_id,a.store_id,a.style,b.name as subtype_name,c.name as prod_name,c.unit,d.name as brand_name
    from ems_monthinventory a
    inner join ems_equipmentsubtype b on a.subtype_id=b.id
    inner join ems_equipmentprod c on a.prod_id=c.id
    inner join ems_brand d on a.brand_id=d.id
    where a.store_id=#{store_id}
     order by a.subtype_id ,a.prod_id,a.brand_id,a.style
   </select>
   <!-- 
   <select id="queryNullMonthReport" resultType="com.mawujun.inventory.MonthInventoryVO">
    select distinct a.subtype_id,a.prod_id,a.brand_id,a.store_id,a.style,b.name as subtype_name,c.name as prod_name,c.unit,d.name as brand_name
    from ems_equipment a
    inner join ems_equipmentsubtype b on a.subtype_id=b.id
    inner join ems_equipmentprod c on a.prod_id=c.id
    inner join ems_brand d on a.brand_id=d.id
    where a.store_id=#{store_id}
     and  a.status !=30
     order by a.subtype_id ,a.prod_id,a.brand_id,a.style
   </select>
    -->
</mapper>

