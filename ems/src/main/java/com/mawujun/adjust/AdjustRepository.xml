<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.mawujun.adjust.AdjustRepository">
	<select id="getAdjustVOByEcode" resultType="com.mawujun.adjust.AdjustListVO" parameterType="java.lang.String">
    	select a.ecode,a.style as equipment_style,a.status as equipment_status,b.name as subtype_name,c.name as prod_name,c.spec as prod_spec,d.name as brand_name,e.name as supplier_name
    	from ems_equipment a
		inner join ems_equipmentsubtype b on a.subtype_id=b.id
		inner join ems_equipmentprod c on a.prod_id=c.id
		inner join ems_brand d on a.brand_id=d.id
		inner join ems_supplier e on a.supplier_id=e.id
		inner join ems_equipment_store f on a.ecode=f.ecode  
		where a.ecode=#{ecode} and f.store_id=#{store_id} 
    </select> 
    

	<select id="query4InStr" resultType="com.mawujun.adjust.AdjustVO" parameterType="map">
		select a.* from ems_adjust a where (a.status='carry' or a.status='noallin')
		and a.str_in_id in (select store_id from sys_userstore c where c.user_id=#{user_id} and c.edit='Y')
	</select>
	
	<!-- 获取调拨单明细-->
	<select id="query4InStrList" resultType="com.mawujun.adjust.AdjustListVO" parameterType="java.lang.String">
    	select f.*,a.style as equipment_style,a.status as equipment_status,b.name as subtype_name,c.name as prod_name,c.spec as prod_spec,d.name as brand_name,e.name as supplier_name 
    	from ems_equipment a
		inner join ems_equipmentsubtype b on a.subtype_id=b.id
		inner join ems_equipmentprod c on a.prod_id=c.id
		inner join ems_brand d on a.brand_id=d.id
		inner join ems_supplier e on a.supplier_id=e.id
		inner join ems_adjustlist f on a.ecode=f.ecode
		where f.adjust_id=#{adjust_id}
		
    </select> 
    
    <select id="sumInnumByadjust_id" resultType="long"  parameterType="java.lang.String">
    	select sum(in_num) from ems_adjustlist where adjust_id=#{adjust_id}
    </select>
    
    <select id="queryPage" resultType="com.mawujun.adjust.AdjustVO" parameterType="map">
		select a.* from ems_adjust a
		<where>
			and a.str_out_id in (select store_id from sys_userstore c where c.user_id=#{user_id} and c.look='Y')
			<if test="str_out_id!=null">
				and a.str_out_id=#{str_out_id}
			</if>
			<if test="str_in_id!=null">
				and a.str_in_id=#{str_in_id}
			</if>
			<if test="str_out_date_start!=null ">
				and to_char(a.str_out_date,'yyyy-mm-dd') &gt;= #{str_out_date_start}
			</if>
			<if test="str_out_date_end!=null">
				and to_char(a.str_out_date,'yyyy-mm-dd') &lt;= #{str_out_date_end}
			</if>
			<if test="status!=null">
				and a.status=#{status}
			</if>
		</where>
	</select>
</mapper>

