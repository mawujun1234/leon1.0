<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.mawujun.baseinfo.CustomerRepository">

	<select id="queryChildren" resultType="com.mawujun.baseinfo.CustomerVO" parameterType="map">
    	SELECT a.*
	    FROM ems_customer  a
		<where>
			<choose>
			    <when test="parent_id!=null and parent_id!=''">
			      a.parent_id = #{parent_id}
			      
			    </when>
			    
			    <otherwise>
			      AND a.type=2 and a.parent_id is null
			    </otherwise>
		    </choose>
		    
		    <if test="name!=null and name!=''">
		    	and a.name like #{name}
		    </if>
		    
        </where>
    </select>
    
    <select id="queryCombo" resultType="com.mawujun.baseinfo.CustomerVO" parameterType="map">
    	SELECT a.*
	    FROM ems_customer  a
		<where>
			status='Y' AND a.type!=2
			
		    <if test="name!=null and name!=''">
		    	and a.name like #{name}
		    </if>
		    <if test="user_id!=null and user_id!=''">
		    	and exists (select 1 from ems_pole b,sys_user_workunit c where b.workunit_id=c.workunit_id and a.id=b.customer_id and c.user_id=#{user_id})
		    </if>
        </where>
    </select>
    
    <select id="queryAreaCombo" resultType="com.mawujun.baseinfo.CustomerVO" parameterType="map">
    	SELECT a.*
	    FROM ems_customer  a
		where status='Y' AND a.type=2

    </select>
   
</mapper>

