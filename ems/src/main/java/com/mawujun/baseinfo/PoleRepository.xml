<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.mawujun.baseinfo.PoleRepository">

	
	<select id="queryPage" resultType="com.mawujun.baseinfo.Pole" parameterType="map">
    	SELECT *
	    FROM ems_pole 
	    where customer_id=#{customer_id}
	    <if test="filterContainArea==true">
	    	and area_id is null
	    </if>
	    order by code
    </select>
    
    <update id="savePoles">
	  	update ems_pole set area_id=#{area_id} where id=#{pole_id}
	</update>
	<update id="deletePoles">
	  	update ems_pole set area_id=null where id=#{pole_id}
	</update>
	<!-- 查询某个杆位下的所有设备 -->
	<select id="queryEquipments" resultType="com.mawujun.baseinfo.EquipmentVO" >
    	select a.*,b.name as subtype_name,c.name as prod_name,c.spec as prod_spec,d.name as brand_name,e.name as supplier_name from ems_equipment a
		inner join ems_equipmentsubtype b on a.subtype_id=b.id
		inner join ems_equipmentprod c on a.prod_id=c.id
		inner join ems_brand d on a.brand_id=d.id
		inner join ems_supplier e on a.supplier_id=e.id
		inner join ems_equipment_pole f on a.ecode=f.ecode
		where f.pole_id=#{id}
    </select>
   
   
    <!-- 查询某个客户下所有的点位 机器点位上的设备信息 -->
    <select id="queryPolesAndEquipments" resultMap="com.mawujun.baseinfo.AreaRepository.poleMap" parameterType="string">
    	SELECT a.*,b.ecode,b.style,b.last_install_date,c.name as subtype_name,d.name as prod_name,d.spec as prod_spec,e.name as brand_name,f.name as supplier_name
      FROM (select a.*,b.name  as customer_name 
           from ems_pole a,ems_customer b where a.customer_id=b.id
              and a.customer_id=#{customer_id})a 
      left join ems_equipment b on a.id=b.pole_id
      left join ems_equipmentsubtype c on b.subtype_id =c.id
      left join ems_equipmentprod d on b.prod_id=d.id
      left join ems_brand e on b.brand_id=e.id
      left join ems_supplier f on b.supplier_id=f.id
		order by a.code asc
    </select>
    
</mapper>

