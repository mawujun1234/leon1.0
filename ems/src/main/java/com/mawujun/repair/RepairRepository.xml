<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.mawujun.repair.RepairRepository">

	<select id="getRepairVOByEcode" resultType="com.mawujun.repair.RepairVO" parameterType="java.lang.String">
    	select a.ecode,a.style as equipment_style,a.status as equipment_status,b.text as subtype_name,c.text as prod_name,d.name as brand_name,d.name as supplier_name ,g.id as str_out_id,g.name as str_out_name
    	from ems_equipment a
		inner join ems_equipmentsubtype b on a.subtype_id=b.id
		inner join ems_equipmentprod c on a.prod_id=c.id
		inner join ems_brand d on a.brand_id=d.id
		inner join ems_supplier e on a.supplier_id=e.id
		inner join ems_storeequipment f on a.ecode=f.ecode
		inner join ems_store g on f.store_id=g.id
		where a.ecode=#{ecode} and g.id=#{store_id} and f.num>0
    </select> 
    
    <select id="storeMgrQuery" resultType="com.mawujun.repair.RepairVO" parameterType="map">
    	select a.*,b.id as scrap_id from ems_repair a left join ems_scrap b on a.id=b.repair_id
    	
		<where>
			
			<if test="str_out_id!=null">
				and a.str_out_id=#{str_out_id}
			</if>
			<if test="rpa_id!=null">
				and a.rpa_id=#{rpa_id}
			</if>
			<if test="str_out_date_start!=null ">
				and to_char(a.str_out_date,'yyyy-mm-dd') &gt;= #{str_out_date_start}
			</if>
			<if test="str_out_date_end!=null">
				and to_char(a.str_out_date,'yyyy-mm-dd') &lt;= #{str_out_date_end}
			</if>
			<if test="ecode!=null">
				and a.ecode=#{ecodes}
			</if>
			<if test="status!=null">
				and a.status=#{status}
			</if>
			<if test="only_have_scap==true">
	    		and b.id is not null
	    	</if>
		</where>
		order by status
    </select>
    <select id="repairInQuery" resultType="com.mawujun.repair.RepairVO" parameterType="map">
    	select * from ems_repair a
		<where>
			<if test="str_out_id!=null">
				and a.str_out_id=#{str_out_id}
			</if>
			<if test="rpa_id!=null">
				and a.rpa_id=#{rpa_id}
			</if>
			<if test="str_out_date_start!=null ">
				and to_char(a.str_out_date,'yyyy-mm-dd') &gt;= #{str_out_date_start}
			</if>
			<if test="str_out_date_end!=null">
				and to_char(a.str_out_date,'yyyy-mm-dd') &lt;= #{str_out_date_end}
			</if>
			<if test="ecode!=null">
				and a.ecode=#{ecodes}
			</if>
			<if test="status!=null">
				and a.status=#{status}
			</if>
		</where>
		order by status
    </select>
    
    <select id="repairMgrQuery" resultType="com.mawujun.repair.RepairVO" parameterType="map">
    	select a.*,b.id as scrap_id from ems_repair a left join ems_scrap b on a.id=b.repair_id
		<where>
			<if test="str_out_id!=null">
				and a.str_out_id=#{str_out_id}
			</if>
			<if test="rpa_id!=null">
				and a.rpa_id=#{rpa_id}
			</if>
			<if test="rpa_in_date_start!=null ">
				and to_char(a.rpa_in_date,'yyyy-mm-dd') &gt;= #{rpa_in_date_start}
			</if>
			<if test="rpa_in_date_end!=null">
				and to_char(a.rpa_in_date,'yyyy-mm-dd') &lt;= #{rpa_in_date_end}
			</if>
			<if test="ecode!=null">
				and a.ecode=#{ecodes}
			</if>
			<if test="status!=null">
				and a.status=#{status}
			</if>
			<if test="only_have_scap==true">
	    		and b.id is not null
	    	</if>
		</where>
		order by status
    </select>
    

</mapper>

