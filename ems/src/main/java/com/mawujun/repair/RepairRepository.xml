<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com-->
<mapper namespace="com.mawujun.repair.RepairRepository">

	<select id="getRepairVOByEcode" resultType="com.mawujun.repair.RepairVO" parameterType="java.lang.String">
    	select a.ecode,a.style as equipment_style,a.status as equipment_status,b.text as subtype_name,c.text as prod_name,d.name as brand_name,d.name as supplier_name ,g.id as str_out_id,g.name as str_out_name
    	from ems_equipment a
		inner join ems_equipmentsubtype b on a.subtype_id=b.id
		inner join ems_equipmentprod c on a.prod_id=c.id
		inner join ems_brand d on a.brand_id=d.id
		inner join ems_supplier e on a.supplier_id=e.id
		inner join ems_storeequipment f on a.ecode=f.ecode
		inner join ems_store g on f.store_id=g.id
		where a.ecode=#{ecode}
    </select> 
    
    <select id="storeQuery" resultType="com.mawujun.repair.RepairVO" parameterType="map">
    	select * from ems_repair a
		<where>
			<if test="str_out_id!=null">
				and a.str_out_id=#{str_out_id}
			</if>
			<if test="rpa_id!=null">
				and a.rpa_id=#{rpa_id}
			</if>
			<if test="str_out_date_start!=null and str_out_date_end!=null">
				and a.str_out_date between to_date(#{str_out_date_start},'yyyy-mm-dd') and to_date(#{str_out_date_end},'yyyy-mm-dd')
			</if>
			<if test="ecode!=null">
				and a.ecode=#{ecodes}
			</if>
			<if test="status!=null">
				and a.status=#{status}
			</if>
		</where>
		order by status
    </select>
</mapper>

