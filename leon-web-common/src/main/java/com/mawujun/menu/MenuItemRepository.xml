<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<!-- mawujun qq:16064988 e-mail:16064988@qq.com 承接各种项目 -->
<!-- 注意文件名称为:-->
<mapper namespace="com.mawujun.menu.MenuItemRepository">
	<select id="query4Desktop" resultType="String" >
    	SELECT distinct a.id
	    FROM leon_MenuItem a
		where a.menu_id=#{menu_id}  
		<if test="parent_id!=null">
			and a.parent_id=#{parent_id}
		</if>
		<if test="parent_id==null">
			and a.parent_id is null
		</if>
		<!-- 不是管理员的话，就要进行权限控制-->
		<if test="isAdmin==false">
			and exists (SELECT b.reportcode FROM leon_menuitem b,LEON_USER_ROLE c,LEON_ROLE_FUN d
where c.role_id=d.role_id and b.fun_id=d.fun_id and charindex(a.reportcode,b.reportcode)=1 and c.user_id=#{user_id})
		</if>
    </select>
    <!-- 用于跨iframe启动另一个窗口的时候,根据jsp获取到相应的menuItem-->
	<select id="queryMenuItem" resultType="com.mawujun.menu.MenuItemVO" >
    	SELECT a.*
	    FROM leon_MenuItem a,leon_fun  b
		where a.menu_id=#{menuId}  and a.fun_id=b.id and b.url=#{jspUrl}
    </select>
    
    <select id="queryAutostarts" resultType="com.mawujun.menu.MenuItemVO" >
    	SELECT a.*,b.url
	    FROM leon_MenuItem a,leon_fun  b
		where a.menu_id=#{menuId}  and a.fun_id=b.id and a.autostart='Y'
    </select>
</mapper>