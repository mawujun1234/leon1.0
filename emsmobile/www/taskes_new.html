<div data-role="page" id="page_taskes_new" data-dom-cache="true">
	<div data-role="header"  data-position="fixed">
    	<a href="#page_homepage" class="ui-btn ui-corner-all" data-theme="c">返回</a>
        <h1>新建任务</h1> 
	</div>
	<div role="main" class="ui-content">
    	<!--<input id="autocomplete-input" data-type="search" placeholder="输入杆位信息...">-->
    	 <a href="taskes_search_pole.html" data-prefetch="true" class="ui-btn ui-corner-all actionbutton">搜索杆位</a>
        <div class="ui-field-contain">
        	<input type="hidden" id="page_taskes_new_type" value="" />
            <input type="hidden" id="page_taskes_new_pole_id" value="" />
        	<label for="page_taskes_new_pole_name">杆位:</label>
            <input type="text"  id="page_taskes_new_pole_name" placeholder="只读" readonly>
       		<label for="page_taskes_new_pole_address">地址:</label>
            <input type="text"  id="page_taskes_new_pole_address" placeholder="只读" readonly>
            <label for="page_taskes_new_memo">任务描述:</label>
            <textarea id="page_taskes_new_memo" placeholder="请输入" data-mini="true"></textarea>  
            
            <div id="page_taskes_new_errorMsg" style="color:red;height:36px;font-weight:bold;"></div>        
         </div>	
         
         <div class="ui-field-contain actionbutton"  align="center">
            <button class="ui-shadow ui-btn ui-corner-all ui-btn-icon-left"  id="page_taskes_new_submitNewTask">提交</button>
         </div>
	</div>
    <script type="application/javascript">
	$(document).ready(function(e) {
		//$( ":mobile-pagecontainer" ).pagecontainer( "load", "taskes_search_pole.html", {  } );
        $(document).on('pagebeforeshow', "#page_taskes_new", function (event, data) {
			var params=window.page_taskes_new_params;	
			if(params.pole_id){
				$("#page_taskes_new_type").val(params.type);
				$("#page_taskes_new_pole_id").val(params.pole_id);
				$("#page_taskes_new_pole_name").val(params.pole_name);
				$("#page_taskes_new_pole_address").val(params.pole_address);
			} else {
				if(params.type=="newInstall"){
					$("h1").html("新建'安装'任务");
				} else if(params.type=="repair"){
					$("h1").html("新建'维修/维护'任务");
				} else if(params.type=="patrol"){
					$("h1").html("新建'巡检任'务");
				} else {
					$("h1").html("新建任务");
				}
				
			}
		});//pagebeforeshow
		$("#page_taskes_new_submitNewTask").click(function(event){
			var params=window.page_taskes_new_params;	
			if(!params.pole_id){
				$("#page_taskes_new_errorMsg").html("请先选择一个杆位");
				return;
			}
			params.memo=$("#page_taskes_new_memo").val();
			$.ajax({   
				url : $.ServerPath+"/task/mobile/create.do",  
				data:params,  
				success : function(data){
					if(data.success==true){	
						$(":mobile-pagecontainer").pagecontainer("change", "#page_homepage", { 
							type:'POST',
							transition:'slideup'
		 				});
						//并且刷新任务,或者移除该任务
						//或者手动构建li，然后动态添加到界面中，同时，别忘记更改page的参数
						window["working_pageParam"].reset();
						queryTasks("working",null,function(){
							taskes_list_query_status["working"]=true;
							
						});
						$("#page_taskes_new_type").val("");
						$("#page_taskes_new_pole_id").val("");
						$("#page_taskes_new_pole_name").val("");
						$("#page_taskes_new_pole_address").val("");
						window.page_taskes_new_params={};
					}
					$.hideLoader();  
				}
			});	//ajax
		//}
		});//click
    });//ready
	</script>
</div>
